@model IEnumerable<ShishaBuilder.Core.DTOs.OrderDtos.AllOrdersViewModelDto>
@using ShishaBuilder.Core.Enums

@if (Model?.Any() != true)
{
  <div class="alert alert-info mb-0">No orders found.</div>
}
else
{
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle mb-0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Hookah</th>
          <th>Table</th>
          <th>Master</th>
          <th>Tobaccos</th>
          <th>Created</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
      @foreach (var order in Model)
      {
        <tr>
          <td>@order.Id</td>
          <td>@(order.Hookah?.ModelName ?? "N/A")</td>
          <td>@(order.Table?.TableNumber.ToString() ?? "N/A")</td>
          <td>
            @(order.Master?.AppUser?.FullName ?? "No Master")
          </td>
          <td>
            @if (order.Tobaccos != null && order.Tobaccos.Any())
            {
              <ul class="list-unstyled mb-0">
                @foreach (var t in order.Tobaccos)
                {
                  <li>@t.Name (@t.Brand) â€“ @t.Percentage%</li>
                }
              </ul>
            }
            else { <span class="text-muted">No tobaccos</span> }
          </td>
          <td>@order.CreatedAt.ToString("g")</td>
          <td>
            <span class="badge @GetStatusBadgeClass(order.OrderStatus)">
              @order.OrderStatus
            </span>
          </td>
          <td>
            <a asp-controller="Order" asp-action="OrderDetails" asp-route-id="@order.Id"
               class="btn btn-sm btn-info">
              <i class="fas fa-eye"></i> Details
            </a>
          </td>
        </tr>
      }
      </tbody>
    </table>
  </div>
}

@functions {
  string GetStatusBadgeClass(OrderStatus status) => status switch
  {
    OrderStatus.Completed  => "badge bg-success",
    OrderStatus.InProgress => "badge bg-primary",
    OrderStatus.Pending    => "badge bg-warning text-dark",
    OrderStatus.Cancelled  => "badge bg-danger",
    _                      => "badge bg-dark"
  };
}
